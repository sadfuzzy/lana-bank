- id: kratos
  upstream:
    url: http://dockerhost-alias:4433
    strip_path: /admin
  match:
    url: <(http|https)>://<[a-zA-Z0-9-.:]+>/admin/<(sessions|self-service)>/<.*>
    methods: [ GET, POST, PUT, OPTIONS, DELETE, PATCH ]
  authenticators:
    - handler: noop
  authorizer:
    handler: allow
  mutators:
    - handler: noop

- id: admin-api # lana/admin-server
  upstream:
    url: http://dockerhost-alias:5253
    strip_path: /admin
  match:
    url: <(http|https)>://<[a-zA-Z0-9-.:]+>/admin/graphql
    methods: [ GET, POST, OPTIONS ]
  authenticators:
    - handler: cookie_session
    - handler: bearer_token
  authorizer:
    handler: allow
  mutators:
    - handler: hydrator
      config:
        api:
          url: http://dockerhost-alias:5253/user/user-id-from-authentication-id
    - handler: id_token
      config:
        claims: '{"aud": ["https://admin-api/graphql"], "subject": {{ print .Extra.subject | toJson }} }'

- id: admin-panel-ui # apps/admin-panel
  upstream:
    url: http://dockerhost-alias:3001
    # strip_path: /admin # nextjs base path will handle this
  match:
    url: <(http|https)>://<[a-zA-Z0-9-.:]+>/admin<(?!\/sessions|\/self-service|\/graphql).*>
    methods: [ GET, POST, OPTIONS, PUT, DELETE, PATCH ]
  authenticators:
    - handler: noop
  authorizer:
    handler: allow
  mutators:
    - handler: noop

- id: lava-core-backend
  upstream:
    url: "http://dockerhost-alias:5252"
  match:
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/graphql"
    methods: ["POST", "GET", "OPTIONS"]
  authenticators:
    - handler: cookie_session
    - handler: bearer_token
  authorizer:
    handler: allow
  mutators:
    - handler: id_token

- id: kratos-public
  upstream:
    url: "http://dockerhost-alias:4433"
  match:
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/<(sessions|self-service)>/<.*>"
    methods: ["POST", "GET", "OPTIONS", "PUT", "DELETE", "PATCH"]
  authenticators:
    - handler: noop
  authorizer:
    handler: allow
  mutators:
    - handler: noop

- id: lava-core-customer-portal
  upstream:
    url: "http://dockerhost-alias:3000"
    preserve_host: true
  match:
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/<(?!sessions|self-service|graphql).*>"
    methods: ["POST", "GET", "OPTIONS"]
  authenticators:
    - handler: cookie_session
    - handler: anonymous
  authorizer:
    handler: allow
  mutators:
    - handler: id_token
